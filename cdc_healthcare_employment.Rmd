---
title: "cdc_healthcare_employment"
author: "John Cruz"
date: "2023-02-28"
output: pdf_document
urlcolor: blue
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

[CDC National Center for Health Statistics](https://www.cdc.gov/nchs/hus/data-finder.htm)

[HCEmpl](https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Publications/Health_US/hus20-21tables/hcempl.xlsx)


each profession and see if employment has been increasing or decreasing and compare this with the change in mean salary. Also, I was thinking about creating a rating or score to see which profession has grown most throughout the last 20 years.

## Required Libraries
```{r library, message=FALSE, warning=FALSE}
library(tidyverse)
library(rio)
library(janitor)
```

## Import Data

```{r import-data, message=FALSE}
url <- 'https://ftp.cdc.gov/pub/Health_Statistics/NCHS/Publications/Health_US/hus20-21tables/hcempl.xlsx'
data = import(url)    # use rio to read URL excel file
```

## Drop Non-Data Rows

```{r drop-rows-rename-columns, warning=FALSE}

updated_data <- 
  data |> 
  filter(!row_number() %in% c(1:3, 49:51)) |>     # drop non-data rows
  row_to_names(row_number = 1) |>         # use janitor to take first row and make them column names
  clean_names()               # clean column names
  
```

## Subset Employment Figures

```{r subset-employment}
updated_employment <- 
  updated_data |> 
  select(c(1:8)) |> 
  gather('year', 'employment', -c('occupation_title'))

updated_employment$year <- 
  updated_employment$year |> 
  parse_number()

knitr::kable(head(updated_employment))

```

## Subset Mean Hourly Wage Figures

```{r subset-wages}
updated_wages <- 
  updated_data |> 
  select(c(1, 9:15)) |> 
  gather('year', 'mean_hourly_wage', -c('occupation_title'))

updated_wages$year <- 
  updated_wages$year |> 
  parse_number()

knitr::kable(head(updated_wages))
```

## Join Employment and Wage Figures

```{r join-employment-wages}
employment_wages <-
  inner_join(updated_employment, updated_wages)

knitr::kable(head(employment_wages))
```

## Clean Occupation Names and Figures

```{r clean-employment-wages}
employment_wages <- 
  employment_wages |> 
  mutate(occupation_title = str_replace(occupation_title, "\\\\[:digit:]", "")) |>  # clean occupation titles
  mutate(employment = str_replace(employment, "[^[:alnum:]]+", "")) |>               # clean employment
  mutate(employment = as.integer(employment)) |> 
  mutate(mean_hourly_wage = str_replace(mean_hourly_wage, "[^[:alnum:]\\.]+", "")) |>     # clean wages
  mutate(mean_hourly_wage = as.numeric(mean_hourly_wage))
```

## Header

```{r test}
```

